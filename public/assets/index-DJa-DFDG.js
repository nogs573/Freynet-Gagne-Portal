import{a as me,p as fe}from"./formatters-Cw2xOObF.js";import{_ as ve}from"./TablePagination.vue_vue_type_script_setup_true_lang-CNnqPXTO.js";import{_ as oe}from"./AppTextField.vue_vue_type_script_setup_true_lang-DLolXYam.js";import{_ as ge}from"./AppSelect.vue_vue_type_script_setup_true_lang-CVASJ1YQ.js";import{_ as he}from"./AddNewUserDrawer.vue_vue_type_script_setup_true_lang-o_Nd6ulP.js";import{_ as _e}from"./AppDrawerHeaderSection.vue_vue_type_script_setup_true_lang-B4ETiiTg.js";import{d as le,r as c,Z as O,w as $,E as J,o as D,g as Q,f as l,b as e,n,am as ye,ag as B,t as S,al as xe,c as H,e as u,F as we,i as Ve,ah as h,v as _,a2 as R,a as Y,x as be}from"./main-Ca4qx7y-.js";import{P as Ue}from"./vue3-perfect-scrollbar.esm-CLCcbP0n.js";import{V as Z}from"./VDivider-CMgOCZ_h.js";import{V as q,a as ke,b as Ce}from"./VCard-k3dQT3Up.js";import{V as N}from"./VCardText-iX3erHMv.js";import{V as Te}from"./VForm-BECb0SyC.js";import{V as K,a as V}from"./VRow-EsZ_8CZn.js";import{V as ee}from"./VSelect-D7uk1eqE.js";import{V as Pe}from"./VNavigationDrawer-BW4FC1x1.js";import{u as te}from"./useApi-CB9ZStik.js";import{$ as Se}from"./api-BzNVkqIw.js";import{V as Ae}from"./VSpacer-BgKUyuZ2.js";import{V as Ee}from"./VDataTableServer-D90LzjZv.js";import{V as ae}from"./VAvatar-B3k1LwfD.js";import{V as De}from"./VImg-C3GobFkp.js";import{V as Ie}from"./VChip-BPUxCjj5.js";import"./helpers-DK5QwNv0.js";import"./VPagination-0LcV90vG.js";import"./form-C6PetfES.js";import"./VTextField-DA7n0c0j.js";/* empty css                   */import"./VCounter-DbxmW7Y4.js";import"./VField-ZOdg6ueh.js";import"./easing-CjukEv2V.js";import"./VInput-iEBwr0fp.js";import"./forwardRefs-C-GTDzx5.js";/* empty css              */import"./VList-P5iFN8Pn.js";import"./ssrBoot-WXvDeQ_A.js";import"./dialog-transition-ianbTZuP.js";import"./VMenu-BXWqdo-4.js";import"./VOverlay-C-c1GQAd.js";import"./delay-DDujfhaz.js";import"./lazy-He9qliih.js";import"./scopeId-B0kCZn--.js";import"./VCheckboxBtn-IHz41y0p.js";import"./VSelectionControl-CJpIFID9.js";import"./VDataTable-DzfJnxTg.js";import"./VTable-bdsfC5QT.js";import"./filter-BytWbrbk.js";import"./VSlideGroup-DbGP5EjM.js";const $e=le({__name:"EditUserDrawer",props:{isDrawerOpen:{type:Boolean},userId:{}},emits:["update:isDrawerOpen","userUpdated"],setup(X,{emit:A}){const f=X,b=A,T=c(!1),p=c(null),d=c(""),U=c(""),k=c(null),y=c(null),x=c([]),w=c([]),z=O(()=>x.value.map(r=>r.name)),L=O(()=>w.value.map(r=>r.name)),j=r=>/^[^\s@]+@[^\s.@]*\.[^\s@]+$/.test(r||"")||"Enter a valid email.",C=async()=>{var r,i;if(f.userId)try{const v=await fetch(`/api/users/${f.userId}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(!v.ok)throw new Error("Failed to fetch user details.");const m=await v.json();d.value=m.name||"",U.value=m.email||"",k.value=((r=x.value.find(s=>s.id===m.company_id))==null?void 0:r.name)||null,y.value=((i=w.value.find(s=>s.id===m.role_id))==null?void 0:i.name)||null}catch(v){console.error("Error fetching user details:",v)}},g=async()=>{try{const[r,i]=await Promise.all([fetch("/api/companies/all",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`}}),fetch("/api/roles",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})]);if(!r.ok)throw new Error("Failed to fetch companies.");if(!i.ok)throw new Error("Failed to fetch roles.");const[v,m]=await Promise.all([r.json(),i.json()]);x.value=v.map(s=>({id:s.id,name:s.companyName})),w.value=m.map(s=>({id:s.id,name:s.name}))}catch(r){console.error("Error fetching dropdown data:",r)}};$(()=>f.userId,async r=>{r&&await C()});const E=()=>{b("update:isDrawerOpen",!1),xe(()=>{var r,i;(r=p.value)==null||r.reset(),(i=p.value)==null||i.resetValidation()})},W=async()=>{var r;f.userId&&((r=p.value)==null||r.validate().then(async({valid:i})=>{var v,m;if(i)try{const s=await fetch(`/api/users/${f.userId}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:JSON.stringify({name:d.value||void 0,email:U.value||void 0,company_id:(v=x.value.find(I=>I.name===k.value))==null?void 0:v.id,role_id:(m=w.value.find(I=>I.name===y.value))==null?void 0:m.id})});if(!s.ok)throw new Error("Failed to update user.");const G=await s.json();b("userUpdated",{success:"User updated successfully!",user:G}),E()}catch(s){console.error("Error updating user:",s),b("userUpdated",{error:"Failed to update user. Please try again."})}}))};return J(async()=>{await g(),f.userId&&await C()}),$(()=>f.userId,async r=>{r&&(await g(),await C())}),(r,i)=>{const v=_e,m=oe;return D(),Q(Pe,{temporary:"",width:400,location:"end",border:"none",class:"scrollable-content","model-value":f.isDrawerOpen,"onUpdate:modelValue":E},{default:l(()=>[e(v,{title:"Edit User",onCancel:E}),e(Z),e(n(Ue),{options:{wheelPropagation:!1}},{default:l(()=>[e(q,{flat:""},{default:l(()=>[e(N,null,{default:l(()=>[e(n(Te),{ref_key:"refForm",ref:p,modelValue:T.value,"onUpdate:modelValue":i[4]||(i[4]=s=>T.value=s),onSubmit:ye(W,["prevent"])},{default:l(()=>[e(K,null,{default:l(()=>[e(V,{cols:"12"},{default:l(()=>[e(m,{modelValue:d.value,"onUpdate:modelValue":i[0]||(i[0]=s=>d.value=s),label:"Username",placeholder:d.value||"Enter username"},null,8,["modelValue","placeholder"])]),_:1}),e(V,{cols:"12"},{default:l(()=>[e(m,{modelValue:U.value,"onUpdate:modelValue":i[1]||(i[1]=s=>U.value=s),rules:[j],label:"Email",placeholder:U.value||"Enter email"},null,8,["modelValue","rules","placeholder"])]),_:1}),e(V,{cols:"12"},{default:l(()=>[e(n(ee),{modelValue:k.value,"onUpdate:modelValue":i[2]||(i[2]=s=>k.value=s),label:"Select Company",placeholder:k.value||"Select Company",items:z.value},null,8,["modelValue","placeholder","items"])]),_:1}),e(V,{cols:"12"},{default:l(()=>[e(n(ee),{modelValue:y.value,"onUpdate:modelValue":i[3]||(i[3]=s=>y.value=s),label:"Select Role",placeholder:y.value||"Select Role",items:L.value},null,8,["modelValue","placeholder","items"])]),_:1}),e(V,{cols:"12"},{default:l(()=>[e(B,{type:"submit",class:"me-4"},{default:l(()=>[S(" Save ")]),_:1}),e(B,{type:"reset",variant:"tonal",color:"error",onClick:E},{default:l(()=>[S(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),Be={class:"d-flex mb-6"},ze={class:"d-flex justify-space-between"},Fe={class:"d-flex flex-column gap-y-1"},Re={class:"text-body-1 text-high-emphasis"},Ne={class:"d-flex gap-x-2 align-center"},Oe={class:"text-h4"},Le={class:"text-sm"},je={class:"me-3 d-flex gap-3"},We={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Ge={style:{"inline-size":"15.625rem"}},Me={class:"d-flex align-center gap-x-4"},He={key:1},Je={class:"d-flex flex-column"},Qe={class:"text-base"},Ze={class:"text-sm"},qe={class:"d-flex align-center gap-x-2"},Ke={class:"text-capitalize text-high-emphasis text-body-1"},Xe={class:"text-body-1 text-high-emphasis text-capitalize"},Ht=le({__name:"index",setup(X){const A=c(""),f=c(),b=c(),T=c(),p=c(10),d=c(1),U=c(),k=c(),y=c([]),x=c(!1),w=c(!1),z=c(null),L=o=>{var a,P,F;console.log("Options received:",o),(a=o.sortBy)!=null&&a.length&&(U.value=(P=o.sortBy[0])==null?void 0:P.key,k.value=(F=o.sortBy[0])==null?void 0:F.order),d.value=o.page||1,p.value=o.itemsPerPage||10,g()},j=[{title:"User",key:"user"},{title:"Role",key:"role"},{title:"Company",key:"company"},{title:"Billing",key:"billing"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],{data:C,execute:g}=te(()=>{const o=new URLSearchParams({page:String(d.value),itemsPerPage:String(p.value)}).toString(),a=localStorage.getItem("accessToken");return console.log("Access Token before API call:",a),console.log("Access Token:",a),console.log("API URL:",`/users?${o}`),`/users?${o}`},{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},credentials:"include"}),E=c({currentPage:1,lastPage:1,total:0,perPage:10,from:0,to:0});$(C,o=>{o&&(E.value={currentPage:o.current_page,lastPage:o.last_page,total:o.total,perPage:o.per_page,from:o.from,to:o.to})},{immediate:!0}),$([A,f,b,T,p,d,U,k],()=>{g()});const W=O(()=>{var o;return((o=C.value)==null?void 0:o.data)||[]}),r=O(()=>{var o;return((o=C.value)==null?void 0:o.total)||0});J(async()=>{try{console.log("Fetching users..."),await g(),console.log("Users fetched:",C.value)}catch(o){console.error("Error fetching users:",o)}});const i=[{title:"Admin",value:"admin"},{title:"Author",value:"author"},{title:"Editor",value:"editor"},{title:"Maintainer",value:"maintainer"},{title:"Subscriber",value:"subscriber"}],v=[{title:"Basic",value:"basic"},{title:"Company",value:"company"},{title:"Enterprise",value:"enterprise"},{title:"Team",value:"team"}],m=[{title:"Pending",value:"pending"},{title:"Active",value:"active"},{title:"Inactive",value:"inactive"}],s=o=>{const a=o.toLowerCase();return a==="subscriber"?{color:"success",icon:"bx-user"}:a==="author"?{color:"error",icon:"bx-desktop"}:a==="maintainer"?{color:"info",icon:"bx-pie-chart-alt"}:a==="editor"?{color:"warning",icon:"bx-edit"}:a==="admin"?{color:"primary",icon:"bx-crown"}:{color:"primary",icon:"bx-user"}},G=o=>{const a=o.toLowerCase();return a==="pending"?"warning":a==="active"?"success":a==="inactive"?"secondary":"primary"},I=async o=>{await Se("/apps/users",{method:"POST",body:o}),g()},se=async o=>{try{if(!(await fetch(`/api/users/${o}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})).ok)throw new Error("Failed to delete user");console.log("User deleted successfully."),g()}catch(a){console.error("Error deleting user:",a)}},re=c([{title:"Session",value:"21,459",change:29,desc:"Total Users",icon:"bx-group",iconColor:"primary"},{title:"Paid Users",value:"4,567",change:18,desc:"Last Week Analytics",icon:"bx-user-plus",iconColor:"error"},{title:"Active Users",value:"19,860",change:-14,desc:"Last Week Analytics",icon:"bx-user-check",iconColor:"success"},{title:"Pending Users",value:"237",change:42,desc:"Last Week Analytics",icon:"bx-user-voice",iconColor:"warning"}]),{data:ne,execute:ie}=te("/users?page=2&itemsPerPage=10",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},credentials:"include"});$(ne,o=>{console.log("Test API Response:",o)},{immediate:!0}),J(async()=>{console.log("Making test API call..."),await ie(),g()});const ce=o=>{z.value=o,w.value=!0};return(o,a)=>{const P=ge,F=oe,ue=Y("RouterLink"),de=Y("IconBtn"),pe=ve;return D(),H("section",null,[u("div",Be,[e(K,null,{default:l(()=>[(D(!0),H(we,null,Ve(n(re),(t,M)=>(D(),Q(V,{key:M,cols:"12",md:"3",sm:"6"},{default:l(()=>[e(q,null,{default:l(()=>[e(N,null,{default:l(()=>[u("div",ze,[u("div",Fe,[u("div",Re,_(t.title),1),u("div",Ne,[u("h4",Oe,_(t.value),1),u("div",{class:be(["text-base",t.change>0?"text-success":"text-error"])}," ("+_(("prefixWithPlus"in o?o.prefixWithPlus:n(fe))(t.change))+"%) ",3)]),u("div",Le,_(t.desc),1)]),e(ae,{color:t.iconColor,variant:"tonal",rounded:"",size:"40"},{default:l(()=>[e(R,{icon:t.icon,size:"24"},null,8,["icon"])]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),e(q,{class:"mb-6"},{default:l(()=>[e(ke,{class:"pb-4"},{default:l(()=>[e(Ce,null,{default:l(()=>[S("Filters")]),_:1})]),_:1}),e(N,null,{default:l(()=>[e(K,null,{default:l(()=>[e(V,{cols:"12",sm:"4"},{default:l(()=>[e(P,{modelValue:n(f),"onUpdate:modelValue":a[0]||(a[0]=t=>h(f)?f.value=t:null),placeholder:"Select Role",items:i,clearable:"","clear-icon":"bx-x"},null,8,["modelValue"])]),_:1}),e(V,{cols:"12",sm:"4"},{default:l(()=>[e(P,{modelValue:n(b),"onUpdate:modelValue":a[1]||(a[1]=t=>h(b)?b.value=t:null),placeholder:"Select Plan",items:v,clearable:"","clear-icon":"bx-x"},null,8,["modelValue"])]),_:1}),e(V,{cols:"12",sm:"4"},{default:l(()=>[e(P,{modelValue:n(T),"onUpdate:modelValue":a[2]||(a[2]=t=>h(T)?T.value=t:null),placeholder:"Select Status",items:m,clearable:"","clear-icon":"bx-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Z),e(N,{class:"d-flex flex-wrap gap-4"},{default:l(()=>[u("div",je,[e(P,{"model-value":n(p),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":a[3]||(a[3]=t=>p.value=parseInt(t,10))},null,8,["model-value"])]),e(Ae),u("div",We,[u("div",Ge,[e(F,{modelValue:n(A),"onUpdate:modelValue":a[4]||(a[4]=t=>h(A)?A.value=t:null),placeholder:"Search User"},null,8,["modelValue"])]),e(B,{variant:"tonal",color:"secondary","prepend-icon":"bx-export"},{default:l(()=>[S(" Export ")]),_:1}),e(B,{"prepend-icon":"bx-plus",onClick:a[5]||(a[5]=t=>x.value=!0)},{default:l(()=>[S(" Add New User ")]),_:1})])]),_:1}),e(Z),e(Ee,{"items-per-page":n(p),"onUpdate:itemsPerPage":a[7]||(a[7]=t=>h(p)?p.value=t:null),"model-value":n(y),"onUpdate:modelValue":a[8]||(a[8]=t=>h(y)?y.value=t:null),page:n(d),"onUpdate:page":a[9]||(a[9]=t=>h(d)?d.value=t:null),items:n(W),"item-value":"id","items-length":n(r),headers:j,class:"text-no-wrap","show-select":"","onUpdate:options":L},{"item.user":l(({item:t})=>[u("div",Me,[e(ae,{size:"34",variant:t.avatar?void 0:"tonal",color:t.avatar?void 0:s(t.role).color},{default:l(()=>[t.avatar?(D(),Q(De,{key:0,src:t.avatar},null,8,["src"])):(D(),H("span",He,_(("avatarText"in o?o.avatarText:n(me))(t.fullName)),1))]),_:2},1032,["variant","color"]),u("div",Je,[u("h6",Qe,[e(ue,{to:{name:"apps-user-view-id",params:{id:t.id}},class:"font-weight-medium text-link"},{default:l(()=>[S(_(t.fullName),1)]),_:2},1032,["to"])]),u("div",Ze,_(t.email),1)])])]),"item.role":l(({item:t})=>[u("div",qe,[e(R,{size:20,icon:s(t.role).icon,color:s(t.role).color},null,8,["icon","color"]),u("div",Ke,_(t.role),1)])]),"item.company":l(({item:t})=>[u("div",Xe,_(t.company||"N/A"),1)]),"item.status":l(({item:t})=>[e(Ie,{color:G(t.status),size:"small",label:"",class:"text-capitalize"},{default:l(()=>[S(_(t.status),1)]),_:2},1032,["color"])]),"item.actions":l(({item:t})=>[e(de,{onClick:M=>se(t.id)},{default:l(()=>[e(R,{icon:"bx-trash"})]),_:2},1032,["onClick"]),e(B,{icon:"",variant:"text",color:"medium-emphasis",onClick:M=>ce(t.id)},{default:l(()=>[e(R,{icon:"bx-pencil"})]),_:2},1032,["onClick"])]),bottom:l(()=>[e(pe,{page:n(d),"onUpdate:page":a[6]||(a[6]=t=>h(d)?d.value=t:null),"items-per-page":n(p),"total-items":n(r)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length"])]),_:1}),e(he,{isDrawerOpen:n(x),"onUpdate:isDrawerOpen":a[10]||(a[10]=t=>h(x)?x.value=t:null),onUserData:I},null,8,["isDrawerOpen"]),e($e,{isDrawerOpen:n(w),"onUpdate:isDrawerOpen":a[11]||(a[11]=t=>h(w)?w.value=t:null),"user-id":n(z),onUserUpdated:n(g)},null,8,["isDrawerOpen","user-id","onUserUpdated"])])}}});export{Ht as default};
