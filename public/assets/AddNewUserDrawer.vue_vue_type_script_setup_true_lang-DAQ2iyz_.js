import{_ as O}from"./AppTextField.vue_vue_type_script_setup_true_lang-D6xyp6vX.js";import{_ as $}from"./AppDrawerHeaderSection.vue_vue_type_script_setup_true_lang-CoICZEIC.js";import{d as P,r as s,Z as b,E as R,o as z,g as I,f as t,b as l,am as M,n as D,ag as T,t as C,al as q}from"./main-B_IkraXW.js";import{P as G}from"./vue3-perfect-scrollbar.esm-eIojcFHH.js";import{V as J}from"./VDivider-Qh1iiapW.js";import{V as H}from"./VCard-CDhfKLoT.js";import{V as Z}from"./VCardText-BYDOgmBH.js";import{V as K}from"./VForm-BF-JC4Gq.js";import{V as L,a as d}from"./VRow-DiOzgfmC.js";import{V as U}from"./VSelect-T95ZSgew.js";import{V as Q}from"./VNavigationDrawer-DNMawaj_.js";const de=P({__name:"AddNewUserDrawer",props:{isDrawerOpen:{type:Boolean}},emits:["update:isDrawerOpen","userData"],setup(k,{emit:N}){const E=k,i=N,g=s(!1),m=s(null),u=s(""),c=s(""),p=s(null),f=s(null),v=s([]),V=s([]),F=b(()=>v.value.map(e=>e.name)),j=b(()=>V.value.map(e=>e.name)),w=e=>!!e||"This field is required.",x=e=>/^[^\s@]+@[^\s.@]*\.[^\s@]+$/.test(e||"")||"Enter a valid email.";R(async()=>{try{const e=await fetch("/api/companies/all",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(!e.ok)throw new Error("Failed to fetch companies.");const a=await e.json();v.value=a.map(o=>({id:o.id,name:o.companyName}));const n=await fetch("/api/roles",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(!n.ok)throw new Error("Failed to fetch roles.");const r=await n.json();V.value=r.map(o=>({id:o.id,name:o.name}))}catch(e){console.error("Error fetching data:",e),i("userData",{error:"Unable to load data. Please try again later."})}});const _=()=>{i("update:isDrawerOpen",!1),q(()=>{var e,a;(e=m.value)==null||e.reset(),(a=m.value)==null||a.resetValidation()})},A=async()=>{var e,a,n;console.log({name:u.value,email:c.value,password:"password123",company_id:(e=v.value.find(r=>r.name===p.value))==null?void 0:e.id,role_id:(a=V.value.find(r=>r.name===f.value))==null?void 0:a.id}),(n=m.value)==null||n.validate().then(async({valid:r})=>{var o,S;if(r)try{const y=await fetch("/api/users",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:JSON.stringify({name:u.value,email:c.value,password:"password123",company_id:(o=v.value.find(h=>h.name===p.value))==null?void 0:o.id,role_id:(S=V.value.find(h=>h.name===f.value))==null?void 0:S.id})});if(!y.ok)throw new Error("Failed to create user");const W=await y.json();i("userData",{success:"User created successfully!"}),_()}catch(y){console.error("Error:",y),i("userData",{error:"Failed to create user. Please try again."})}})},B=e=>{i("update:isDrawerOpen",e)};return(e,a)=>{const n=$,r=O;return z(),I(Q,{temporary:"",width:400,location:"end",border:"none",class:"scrollable-content","model-value":E.isDrawerOpen,"onUpdate:modelValue":B},{default:t(()=>[l(n,{title:"Add New User",onCancel:_}),l(J),l(D(G),{options:{wheelPropagation:!1}},{default:t(()=>[l(H,{flat:""},{default:t(()=>[l(Z,null,{default:t(()=>[l(K,{ref_key:"refForm",ref:m,modelValue:g.value,"onUpdate:modelValue":a[4]||(a[4]=o=>g.value=o),onSubmit:M(A,["prevent"])},{default:t(()=>[l(L,null,{default:t(()=>[l(d,{cols:"12"},{default:t(()=>[l(r,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=o=>u.value=o),rules:[w],label:"Username",placeholder:"Johndoe"},null,8,["modelValue","rules"])]),_:1}),l(d,{cols:"12"},{default:t(()=>[l(r,{modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=o=>c.value=o),rules:[w,x],label:"Email",placeholder:"johndoe@email.com"},null,8,["modelValue","rules"])]),_:1}),l(d,{cols:"12"},{default:t(()=>[l(D(U),{modelValue:p.value,"onUpdate:modelValue":a[2]||(a[2]=o=>p.value=o),rules:[w],label:"Select Company",placeholder:"Select Company",items:F.value},null,8,["modelValue","rules","items"])]),_:1}),l(d,{cols:"12"},{default:t(()=>[l(D(U),{modelValue:f.value,"onUpdate:modelValue":a[3]||(a[3]=o=>f.value=o),rules:[w],label:"Select Role",placeholder:"Select Role",items:j.value},null,8,["modelValue","rules","items"])]),_:1}),l(d,{cols:"12"},{default:t(()=>[l(T,{type:"submit",class:"me-4"},{default:t(()=>[C(" Submit ")]),_:1}),l(T,{type:"reset",variant:"tonal",color:"error",onClick:_},{default:t(()=>[C(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}});export{de as _};
