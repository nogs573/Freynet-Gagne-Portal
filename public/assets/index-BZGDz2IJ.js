import{a as me,p as fe}from"./formatters-Cw2xOObF.js";import{_ as ve}from"./TablePagination.vue_vue_type_script_setup_true_lang-D2rntBvo.js";import{_ as oe}from"./AppTextField.vue_vue_type_script_setup_true_lang-D6xyp6vX.js";import{_ as ge}from"./AppSelect.vue_vue_type_script_setup_true_lang-DL5zvXSE.js";import{_ as he}from"./AddNewUserDrawer.vue_vue_type_script_setup_true_lang-DAQ2iyz_.js";import{_ as _e}from"./AppDrawerHeaderSection.vue_vue_type_script_setup_true_lang-CoICZEIC.js";import{d as le,r as c,Z as O,w as $,E as J,o as D,g as Q,f as l,b as e,n,am as ye,ag as B,t as S,al as xe,c as H,e as u,F as we,i as Ve,ah as h,v as _,a2 as R,a as Y,x as be}from"./main-B_IkraXW.js";import{P as Ue}from"./vue3-perfect-scrollbar.esm-eIojcFHH.js";import{V as Z}from"./VDivider-Qh1iiapW.js";import{V as q,a as ke,b as Ce}from"./VCard-CDhfKLoT.js";import{V as N}from"./VCardText-BYDOgmBH.js";import{V as Te}from"./VForm-BF-JC4Gq.js";import{V as K,a as V}from"./VRow-DiOzgfmC.js";import{V as ee}from"./VSelect-T95ZSgew.js";import{V as Pe}from"./VNavigationDrawer-DNMawaj_.js";import{u as te}from"./useApi-C4bwuVJP.js";import{$ as Se}from"./api-C4WQXWBS.js";import{V as Ee}from"./VSpacer-BGWik_ij.js";import{V as Ae}from"./VDataTableServer-DTGlGHGl.js";import{V as ae}from"./VAvatar-BcpaEIM6.js";import{V as De}from"./VImg-BO9Zigf-.js";import{V as Ie}from"./VChip-F9Nor7u-.js";import"./helpers-DK5QwNv0.js";import"./VPagination-CWCocK62.js";import"./form-BHNnBXi0.js";import"./VTextField-uiEAHpJ_.js";/* empty css                   */import"./VCounter-DYU4wMzG.js";import"./VField-DRGqa92q.js";import"./easing-CjukEv2V.js";import"./VInput-DV2F-Zc0.js";import"./forwardRefs-C-GTDzx5.js";/* empty css              */import"./VList-HMFSxqsa.js";import"./ssrBoot-B54qnyWz.js";import"./dialog-transition-D8U3RT0-.js";import"./VMenu-D2KHfxCp.js";import"./VOverlay-dFaES_so.js";import"./delay-D4G2LFdP.js";import"./lazy-xYuCvjAu.js";import"./scopeId-CwrWLC2I.js";import"./VCheckboxBtn-Iz1ZzbNu.js";import"./VSelectionControl-DF7kQOL_.js";import"./VDataTable-B9bqhY3q.js";import"./VTable-uXjTDlvS.js";import"./filter-CHZoZlsc.js";import"./VSlideGroup-CPnGi2wt.js";const $e=le({__name:"EditUserDrawer",props:{isDrawerOpen:{type:Boolean},userId:{}},emits:["update:isDrawerOpen","userUpdated"],setup(X,{emit:E}){const f=X,b=E,T=c(!1),p=c(null),d=c(""),U=c(""),k=c(null),y=c(null),x=c([]),w=c([]),z=O(()=>x.value.map(r=>r.name)),L=O(()=>w.value.map(r=>r.name)),j=r=>/^[^\s@]+@[^\s.@]*\.[^\s@]+$/.test(r||"")||"Enter a valid email.",C=async()=>{var r,i;if(f.userId)try{const v=await fetch(`/api/users/${f.userId}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(!v.ok)throw new Error("Failed to fetch user details.");const m=await v.json();d.value=m.name||"",U.value=m.email||"",k.value=((r=x.value.find(s=>s.id===m.company_id))==null?void 0:r.name)||null,y.value=((i=w.value.find(s=>s.id===m.role_id))==null?void 0:i.name)||null}catch(v){console.error("Error fetching user details:",v)}},g=async()=>{try{const[r,i]=await Promise.all([fetch("/api/companies/all",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`}}),fetch("/api/roles",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})]);if(!r.ok)throw new Error("Failed to fetch companies.");if(!i.ok)throw new Error("Failed to fetch roles.");const[v,m]=await Promise.all([r.json(),i.json()]);x.value=v.map(s=>({id:s.id,name:s.companyName})),w.value=m.map(s=>({id:s.id,name:s.name}))}catch(r){console.error("Error fetching dropdown data:",r)}};$(()=>f.userId,async r=>{r&&await C()});const A=()=>{b("update:isDrawerOpen",!1),xe(()=>{var r,i;(r=p.value)==null||r.reset(),(i=p.value)==null||i.resetValidation()})},W=async()=>{var r;f.userId&&((r=p.value)==null||r.validate().then(async({valid:i})=>{var v,m;if(i)try{const s=await fetch(`/api/users/${f.userId}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:JSON.stringify({name:d.value||void 0,email:U.value||void 0,company_id:(v=x.value.find(I=>I.name===k.value))==null?void 0:v.id,role_id:(m=w.value.find(I=>I.name===y.value))==null?void 0:m.id})});if(!s.ok)throw new Error("Failed to update user.");const G=await s.json();b("userUpdated",{success:"User updated successfully!",user:G}),A()}catch(s){console.error("Error updating user:",s),b("userUpdated",{error:"Failed to update user. Please try again."})}}))};return J(async()=>{await g(),f.userId&&await C()}),$(()=>f.userId,async r=>{r&&(await g(),await C())}),(r,i)=>{const v=_e,m=oe;return D(),Q(Pe,{temporary:"",width:400,location:"end",border:"none",class:"scrollable-content","model-value":f.isDrawerOpen,"onUpdate:modelValue":A},{default:l(()=>[e(v,{title:"Edit User",onCancel:A}),e(Z),e(n(Ue),{options:{wheelPropagation:!1}},{default:l(()=>[e(q,{flat:""},{default:l(()=>[e(N,null,{default:l(()=>[e(n(Te),{ref_key:"refForm",ref:p,modelValue:T.value,"onUpdate:modelValue":i[4]||(i[4]=s=>T.value=s),onSubmit:ye(W,["prevent"])},{default:l(()=>[e(K,null,{default:l(()=>[e(V,{cols:"12"},{default:l(()=>[e(m,{modelValue:d.value,"onUpdate:modelValue":i[0]||(i[0]=s=>d.value=s),label:"Username",placeholder:d.value||"Enter username"},null,8,["modelValue","placeholder"])]),_:1}),e(V,{cols:"12"},{default:l(()=>[e(m,{modelValue:U.value,"onUpdate:modelValue":i[1]||(i[1]=s=>U.value=s),rules:[j],label:"Email",placeholder:U.value||"Enter email"},null,8,["modelValue","rules","placeholder"])]),_:1}),e(V,{cols:"12"},{default:l(()=>[e(n(ee),{modelValue:k.value,"onUpdate:modelValue":i[2]||(i[2]=s=>k.value=s),label:"Select Company",placeholder:k.value||"Select Company",items:z.value},null,8,["modelValue","placeholder","items"])]),_:1}),e(V,{cols:"12"},{default:l(()=>[e(n(ee),{modelValue:y.value,"onUpdate:modelValue":i[3]||(i[3]=s=>y.value=s),label:"Select Role",placeholder:y.value||"Select Role",items:L.value},null,8,["modelValue","placeholder","items"])]),_:1}),e(V,{cols:"12"},{default:l(()=>[e(B,{type:"submit",class:"me-4"},{default:l(()=>[S(" Save ")]),_:1}),e(B,{type:"reset",variant:"tonal",color:"error",onClick:A},{default:l(()=>[S(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),Be={class:"d-flex mb-6"},ze={class:"d-flex justify-space-between"},Fe={class:"d-flex flex-column gap-y-1"},Re={class:"text-body-1 text-high-emphasis"},Ne={class:"d-flex gap-x-2 align-center"},Oe={class:"text-h4"},Le={class:"text-sm"},je={class:"me-3 d-flex gap-3"},We={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Ge={style:{"inline-size":"15.625rem"}},Me={class:"d-flex align-center gap-x-4"},He={key:1},Je={class:"d-flex flex-column"},Qe={class:"text-base"},Ze={class:"text-sm"},qe={class:"d-flex align-center gap-x-2"},Ke={class:"text-capitalize text-high-emphasis text-body-1"},Xe={class:"text-body-1 text-high-emphasis text-capitalize"},Ht=le({__name:"index",setup(X){const E=c(""),f=c(),b=c(),T=c(),p=c(10),d=c(1),U=c(),k=c(),y=c([]),x=c(!1),w=c(!1),z=c(null),L=a=>{var o,P,F;console.log("Options received:",a),(o=a.sortBy)!=null&&o.length&&(U.value=(P=a.sortBy[0])==null?void 0:P.key,k.value=(F=a.sortBy[0])==null?void 0:F.order),d.value=a.page||1,p.value=a.itemsPerPage||10,g()},j=[{title:"User",key:"user"},{title:"Role",key:"role"},{title:"Company",key:"company"},{title:"Billing",key:"billing"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],{data:C,execute:g}=te(()=>{const a=new URLSearchParams({page:String(d.value),itemsPerPage:String(p.value)}).toString(),o=localStorage.getItem("accessToken");return console.log("Access Token:",o),console.log("API URL:",`/users?${a}`),`/users?${a}`},{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},credentials:"include"}),A=c({currentPage:1,lastPage:1,total:0,perPage:10,from:0,to:0});$(C,a=>{a&&(A.value={currentPage:a.current_page,lastPage:a.last_page,total:a.total,perPage:a.per_page,from:a.from,to:a.to})},{immediate:!0}),$([E,f,b,T,p,d,U,k],()=>{g()});const W=O(()=>{var a;return((a=C.value)==null?void 0:a.data)||[]}),r=O(()=>{var a;return((a=C.value)==null?void 0:a.total)||0});J(async()=>{try{console.log("Fetching users..."),await g(),console.log("Users fetched:",C.value)}catch(a){console.error("Error fetching users:",a)}});const i=[{title:"Admin",value:"admin"},{title:"Author",value:"author"},{title:"Editor",value:"editor"},{title:"Maintainer",value:"maintainer"},{title:"Subscriber",value:"subscriber"}],v=[{title:"Basic",value:"basic"},{title:"Company",value:"company"},{title:"Enterprise",value:"enterprise"},{title:"Team",value:"team"}],m=[{title:"Pending",value:"pending"},{title:"Active",value:"active"},{title:"Inactive",value:"inactive"}],s=a=>{const o=a.toLowerCase();return o==="subscriber"?{color:"success",icon:"bx-user"}:o==="author"?{color:"error",icon:"bx-desktop"}:o==="maintainer"?{color:"info",icon:"bx-pie-chart-alt"}:o==="editor"?{color:"warning",icon:"bx-edit"}:o==="admin"?{color:"primary",icon:"bx-crown"}:{color:"primary",icon:"bx-user"}},G=a=>{const o=a.toLowerCase();return o==="pending"?"warning":o==="active"?"success":o==="inactive"?"secondary":"primary"},I=async a=>{await Se("/apps/users",{method:"POST",body:a}),g()},se=async a=>{try{if(!(await fetch(`/api/users/${a}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})).ok)throw new Error("Failed to delete user");console.log("User deleted successfully."),g()}catch(o){console.error("Error deleting user:",o)}},re=c([{title:"Session",value:"21,459",change:29,desc:"Total Users",icon:"bx-group",iconColor:"primary"},{title:"Paid Users",value:"4,567",change:18,desc:"Last Week Analytics",icon:"bx-user-plus",iconColor:"error"},{title:"Active Users",value:"19,860",change:-14,desc:"Last Week Analytics",icon:"bx-user-check",iconColor:"success"},{title:"Pending Users",value:"237",change:42,desc:"Last Week Analytics",icon:"bx-user-voice",iconColor:"warning"}]),{data:ne,execute:ie}=te("/users?page=2&itemsPerPage=10",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},credentials:"include"});$(ne,a=>{console.log("Test API Response:",a)},{immediate:!0}),J(async()=>{console.log("Making test API call..."),await ie(),g()});const ce=a=>{z.value=a,w.value=!0};return(a,o)=>{const P=ge,F=oe,ue=Y("RouterLink"),de=Y("IconBtn"),pe=ve;return D(),H("section",null,[u("div",Be,[e(K,null,{default:l(()=>[(D(!0),H(we,null,Ve(n(re),(t,M)=>(D(),Q(V,{key:M,cols:"12",md:"3",sm:"6"},{default:l(()=>[e(q,null,{default:l(()=>[e(N,null,{default:l(()=>[u("div",ze,[u("div",Fe,[u("div",Re,_(t.title),1),u("div",Ne,[u("h4",Oe,_(t.value),1),u("div",{class:be(["text-base",t.change>0?"text-success":"text-error"])}," ("+_(("prefixWithPlus"in a?a.prefixWithPlus:n(fe))(t.change))+"%) ",3)]),u("div",Le,_(t.desc),1)]),e(ae,{color:t.iconColor,variant:"tonal",rounded:"",size:"40"},{default:l(()=>[e(R,{icon:t.icon,size:"24"},null,8,["icon"])]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),e(q,{class:"mb-6"},{default:l(()=>[e(ke,{class:"pb-4"},{default:l(()=>[e(Ce,null,{default:l(()=>[S("Filters")]),_:1})]),_:1}),e(N,null,{default:l(()=>[e(K,null,{default:l(()=>[e(V,{cols:"12",sm:"4"},{default:l(()=>[e(P,{modelValue:n(f),"onUpdate:modelValue":o[0]||(o[0]=t=>h(f)?f.value=t:null),placeholder:"Select Role",items:i,clearable:"","clear-icon":"bx-x"},null,8,["modelValue"])]),_:1}),e(V,{cols:"12",sm:"4"},{default:l(()=>[e(P,{modelValue:n(b),"onUpdate:modelValue":o[1]||(o[1]=t=>h(b)?b.value=t:null),placeholder:"Select Plan",items:v,clearable:"","clear-icon":"bx-x"},null,8,["modelValue"])]),_:1}),e(V,{cols:"12",sm:"4"},{default:l(()=>[e(P,{modelValue:n(T),"onUpdate:modelValue":o[2]||(o[2]=t=>h(T)?T.value=t:null),placeholder:"Select Status",items:m,clearable:"","clear-icon":"bx-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Z),e(N,{class:"d-flex flex-wrap gap-4"},{default:l(()=>[u("div",je,[e(P,{"model-value":n(p),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":o[3]||(o[3]=t=>p.value=parseInt(t,10))},null,8,["model-value"])]),e(Ee),u("div",We,[u("div",Ge,[e(F,{modelValue:n(E),"onUpdate:modelValue":o[4]||(o[4]=t=>h(E)?E.value=t:null),placeholder:"Search User"},null,8,["modelValue"])]),e(B,{variant:"tonal",color:"secondary","prepend-icon":"bx-export"},{default:l(()=>[S(" Export ")]),_:1}),e(B,{"prepend-icon":"bx-plus",onClick:o[5]||(o[5]=t=>x.value=!0)},{default:l(()=>[S(" Add New User ")]),_:1})])]),_:1}),e(Z),e(Ae,{"items-per-page":n(p),"onUpdate:itemsPerPage":o[7]||(o[7]=t=>h(p)?p.value=t:null),"model-value":n(y),"onUpdate:modelValue":o[8]||(o[8]=t=>h(y)?y.value=t:null),page:n(d),"onUpdate:page":o[9]||(o[9]=t=>h(d)?d.value=t:null),items:n(W),"item-value":"id","items-length":n(r),headers:j,class:"text-no-wrap","show-select":"","onUpdate:options":L},{"item.user":l(({item:t})=>[u("div",Me,[e(ae,{size:"34",variant:t.avatar?void 0:"tonal",color:t.avatar?void 0:s(t.role).color},{default:l(()=>[t.avatar?(D(),Q(De,{key:0,src:t.avatar},null,8,["src"])):(D(),H("span",He,_(("avatarText"in a?a.avatarText:n(me))(t.fullName)),1))]),_:2},1032,["variant","color"]),u("div",Je,[u("h6",Qe,[e(ue,{to:{name:"apps-user-view-id",params:{id:t.id}},class:"font-weight-medium text-link"},{default:l(()=>[S(_(t.fullName),1)]),_:2},1032,["to"])]),u("div",Ze,_(t.email),1)])])]),"item.role":l(({item:t})=>[u("div",qe,[e(R,{size:20,icon:s(t.role).icon,color:s(t.role).color},null,8,["icon","color"]),u("div",Ke,_(t.role),1)])]),"item.company":l(({item:t})=>[u("div",Xe,_(t.company||"N/A"),1)]),"item.status":l(({item:t})=>[e(Ie,{color:G(t.status),size:"small",label:"",class:"text-capitalize"},{default:l(()=>[S(_(t.status),1)]),_:2},1032,["color"])]),"item.actions":l(({item:t})=>[e(de,{onClick:M=>se(t.id)},{default:l(()=>[e(R,{icon:"bx-trash"})]),_:2},1032,["onClick"]),e(B,{icon:"",variant:"text",color:"medium-emphasis",onClick:M=>ce(t.id)},{default:l(()=>[e(R,{icon:"bx-pencil"})]),_:2},1032,["onClick"])]),bottom:l(()=>[e(pe,{page:n(d),"onUpdate:page":o[6]||(o[6]=t=>h(d)?d.value=t:null),"items-per-page":n(p),"total-items":n(r)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length"])]),_:1}),e(he,{isDrawerOpen:n(x),"onUpdate:isDrawerOpen":o[10]||(o[10]=t=>h(x)?x.value=t:null),onUserData:I},null,8,["isDrawerOpen"]),e($e,{isDrawerOpen:n(w),"onUpdate:isDrawerOpen":o[11]||(o[11]=t=>h(w)?w.value=t:null),"user-id":n(z),onUserUpdated:n(g)},null,8,["isDrawerOpen","user-id","onUserUpdated"])])}}});export{Ht as default};
