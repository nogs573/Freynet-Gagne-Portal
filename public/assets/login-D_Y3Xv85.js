import{r as x,e as O}from"./validators-DpYrMFzk.js";import{d as q,r as p,as as B,o as C,c as I,b as e,f as t,e as s,n as a,G as b,v as h,t as n,g as J,y as U,am as E,ah as $,ag as M,F as W,k as z,a as G,at as y}from"./main-COzPSvmz.js";import{_ as H}from"./AppTextField.vue_vue_type_script_setup_true_lang-Dba_d-Do.js";import{_ as K}from"./AuthProvider.vue_vue_type_script_setup_true_lang-DUuHhSwl.js";import{m as Q}from"./auth-v2-login-illustration-DLwz24sJ.js";import{V as X}from"./VNodeRenderer-Cg57jei6.js";import{a as d,V as S}from"./VRow-BJ3vRaQf.js";import{V as Y}from"./VImg-Mm9y2cRD.js";import{V as Z}from"./VCard-n1X1cK2l.js";import{V as v}from"./VCardText-Cwvv1NXL.js";import{V as R}from"./VAlert-DTjYz7xP.js";import{V as ee}from"./VForm-Df3rddCt.js";import{V as ae}from"./VCheckbox-Cilk04vS.js";import{V as N}from"./VDivider-BaT1F8ur.js";import"./helpers-DK5QwNv0.js";import"./form-D3LuPyIe.js";import"./VTextField-Bvt5xpEn.js";/* empty css                   */import"./VCounter-D7mVbNfZ.js";import"./VField-DTZzSet7.js";import"./easing-CjukEv2V.js";import"./VInput-DmbVP3f3.js";import"./forwardRefs-C-GTDzx5.js";/* empty css              */import"./VAvatar-BgzCTEhE.js";import"./VCheckboxBtn-Jm2QJJl5.js";import"./VSelectionControl-DTAglom5.js";const te={class:"auth-logo d-flex align-center gap-x-2"},oe={class:"auth-title"},se={class:"position-relative bg-background w-100 pa-8"},re={class:"d-flex align-center justify-center w-100 h-100"},le={class:"text-h4 mb-1"},ne={class:"text-capitalize"},ie=s("p",{class:"mb-0"}," Please sign-in to your account and start the adventure ",-1),de=s("p",{class:"text-sm mb-2"},[n(" Admin Email: "),s("strong",null,"admin@demo.com"),n(" / Pass: "),s("strong",null,"admin")],-1),me=s("p",{class:"text-sm mb-0"},[n(" Client Email: "),s("strong",null,"client@demo.com"),n(" / Pass: "),s("strong",null,"client")],-1),ce={class:"d-flex align-center flex-wrap justify-space-between my-6"},ue=s("span",{class:"d-inline-block"}," New on our platform? ",-1),pe=s("span",{class:"mx-4"},"or",-1),$e=q({__name:"login",setup(fe){const f=p(!1),w=z(),T=B(),m=p({email:void 0,password:void 0,general:void 0}),k=p(),c=p({email:"email",password:"password"});!!document.cookie.split("; ").find(o=>o.startsWith("accessToken="))&&w.replace({name:"dashboards-crm"});const g=p(!1),j=async()=>{var r;try{const o=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:c.value.email,password:c.value.password,remember_me:g.value})});if(!o.ok){const V=await o.json();m.value.general=V.message||"Login failed. Please try again.";return}const{accessToken:u,userData:i,abilityRules:l}=await o.json();console.log("Ability Rules received:",l),console.log("User Data:",i),T.update(l.map(V=>({action:V.action.toLowerCase(),subject:V.subject.toLowerCase()})));const P=y("userData"),D=y("userAbilityRules"),F=y("accessToken");localStorage.setItem("userData",JSON.stringify(i)),localStorage.setItem("abilityRules",JSON.stringify(l)),localStorage.setItem("accessToken",u.toString()),P.value=JSON.stringify(i),D.value=JSON.stringify(l),F.value=u.toString(),console.log("Document.cookie from login.vue",document.cookie);const _=((r=i.role)==null?void 0:r.toLowerCase())||"User",L=_==="admin"?{name:"sdtestpage"}:_==="client"?{name:"sdtestpage"}:_==="user"?{name:"dashboards-crm"}:_==="manager"?{name:"sdtestpage"}:{name:"dashboards-analytics"};w.replace(L)}catch(o){console.error("login error",o),m.value.general="An error occurred. Please try again."}},A=()=>{var r;(r=k.value)==null||r.validate().then(({valid:o})=>{o&&j()})};return(r,o)=>{const u=G("RouterLink"),i=H;return C(),I(W,null,[e(u,{to:"/"},{default:t(()=>[s("div",te,[e(a(X),{nodes:a(b).app.logo},null,8,["nodes"]),s("h1",oe,h(a(b).app.title),1)])]),_:1}),e(S,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:t(()=>[e(d,{md:"8",class:"d-none d-md-flex"},{default:t(()=>[s("div",se,[s("div",re,[e(Y,{"max-width":"700",src:a(Q),class:"auth-illustration"},null,8,["src"])])])]),_:1}),e(d,{cols:"12",md:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:t(()=>[e(Z,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-6"},{default:t(()=>[e(v,null,{default:t(()=>[s("h4",le,[n(" Welcome to "),s("span",ne,h(a(b).app.title),1),n("! 👋🏻 ")]),ie]),_:1}),e(v,null,{default:t(()=>[a(m).general?(C(),J(R,{key:0,value:!!a(m).general,color:"error",variant:"tonal",class:"mb-4"},{default:t(()=>[n(h(a(m).general),1)]),_:1},8,["value"])):U("",!0),e(R,{color:"primary",variant:"tonal"},{default:t(()=>[de,me]),_:1})]),_:1}),e(v,null,{default:t(()=>[e(a(ee),{ref_key:"refVForm",ref:k,onSubmit:E(A,["prevent"])},{default:t(()=>[e(S,null,{default:t(()=>[e(d,{cols:"12"},{default:t(()=>[e(i,{modelValue:a(c).email,"onUpdate:modelValue":o[0]||(o[0]=l=>a(c).email=l),label:"Email",placeholder:"johndoe@email.com",type:"email",autofocus:"",rules:["requiredValidator"in r?r.requiredValidator:a(x),"emailValidator"in r?r.emailValidator:a(O)]},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12"},{default:t(()=>[e(i,{modelValue:a(c).password,"onUpdate:modelValue":o[1]||(o[1]=l=>a(c).password=l),label:"Password",placeholder:"············",rules:["requiredValidator"in r?r.requiredValidator:a(x)],type:a(f)?"text":"password","error-messages":a(m).password,"append-inner-icon":a(f)?"bx-hide":"bx-show","onClick:appendInner":o[2]||(o[2]=l=>f.value=!a(f))},null,8,["modelValue","rules","type","error-messages","append-inner-icon"]),s("div",ce,[e(ae,{modelValue:a(g),"onUpdate:modelValue":o[3]||(o[3]=l=>$(g)?g.value=l:null),label:"Remember me"},null,8,["modelValue"]),e(u,{class:"text-primary",to:{name:"forgot-password"}},{default:t(()=>[n(" Forgot Password? ")]),_:1})]),e(M,{block:"",type:"submit"},{default:t(()=>[n(" Login ")]),_:1})]),_:1}),e(d,{cols:"12",class:"text-body-1 text-center"},{default:t(()=>[ue,e(u,{class:"text-primary ms-1 d-inline-block text-body-1",to:{name:"register"}},{default:t(()=>[n(" Create an account ")]),_:1})]),_:1}),e(d,{cols:"12",class:"d-flex align-center"},{default:t(()=>[e(N),pe,e(N)]),_:1}),e(d,{cols:"12",class:"text-center"},{default:t(()=>[e(K)]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})],64)}}});export{$e as default};
