import{_ as A}from"./AppTextField.vue_vue_type_script_setup_true_lang-Dba_d-Do.js";import{_ as W}from"./AppSelect.vue_vue_type_script_setup_true_lang-mfWXM2VL.js";import{_ as P}from"./AppDrawerHeaderSection.vue_vue_type_script_setup_true_lang-CTgVjhwx.js";import{d as T,r as s,o as U,g as F,f as a,b as e,am as j,ag as _,t as h,w as z,E as q,al as X,Z as O,c as Y,e as k,v as ee,a2 as I,a as ae}from"./main-COzPSvmz.js";import{V as E}from"./VDivider-BaT1F8ur.js";import{V as R}from"./VForm-Df3rddCt.js";import{V as B,a as g}from"./VRow-BJ3vRaQf.js";import{V as x}from"./VCardText-Cwvv1NXL.js";import{V as G}from"./VNavigationDrawer-BnshVB9y.js";import{V as oe}from"./VTextField-Bvt5xpEn.js";import{u as te}from"./useApi-D6Fo_5Xj.js";import{a as le,b as ne,V as $}from"./VCard-n1X1cK2l.js";import{V as re}from"./VSpacer-DOYHaAei.js";import{V as se}from"./VDataTableServer-CZwnwMnj.js";import"./form-D3LuPyIe.js";import"./VSelect-B9TDWHSZ.js";import"./forwardRefs-C-GTDzx5.js";import"./VList-CNvbjYBq.js";import"./ssrBoot-5xkFD_xz.js";import"./VImg-Mm9y2cRD.js";import"./VAvatar-BgzCTEhE.js";import"./dialog-transition-svcbKRDj.js";import"./easing-CjukEv2V.js";import"./VMenu-Wpc6e35-.js";import"./VOverlay-NcYmFA8g.js";import"./delay-BHYXvR4k.js";import"./lazy-D9Z9oHvh.js";import"./scopeId-Cu4Sm8bO.js";import"./VCheckboxBtn-Jm2QJJl5.js";import"./VSelectionControl-DTAglom5.js";import"./VChip-DPeYBiGA.js";import"./VSlideGroup-S6brIomR.js";/* empty css              *//* empty css                   */import"./VCounter-D7mVbNfZ.js";import"./VField-DTZzSet7.js";import"./VInput-DmbVP3f3.js";import"./VDataTable-BtROIyg_.js";import"./VPagination-Dxg7NyDu.js";import"./VTable-D8lrf0MJ.js";import"./filter-ClxjHxUY.js";const ie=T({__name:"AddNewCompanyDrawer",props:{isDrawerOpen:{type:Boolean,required:!0}},emits:["update:isDrawerOpen","companyData"],setup(D,{emit:y}){const p=D,d=y,i=s(""),m=s(!1),u=n=>!!n||"This field is required.",c=()=>{d("update:isDrawerOpen",!1),i.value=""},V=async()=>{if(!i.value.trim()){console.error("Company name is required");return}try{const n=await fetch("/api/companies",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:JSON.stringify({company_name:i.value.trim()})});if(!n.ok)throw new Error("Failed to create company.");const r=await n.json();d("companyData",{success:"Company created successfully!",data:r}),c()}catch(n){console.error("Error adding company:",n),d("companyData",{error:"Failed to create company. Please try again."})}};return(n,r)=>{const C=P,f=A;return U(),F(G,{modelValue:p.isDrawerOpen,"onUpdate:modelValue":r[2]||(r[2]=v=>p.isDrawerOpen=v),temporary:"",width:400,location:"end",border:"none"},{default:a(()=>[e(C,{title:"Add New Company",onCancel:c}),e(E),e(x,null,{default:a(()=>[e(R,{modelValue:m.value,"onUpdate:modelValue":r[1]||(r[1]=v=>m.value=v),onSubmit:j(V,["prevent"])},{default:a(()=>[e(B,null,{default:a(()=>[e(g,{cols:"12"},{default:a(()=>[e(f,{modelValue:i.value,"onUpdate:modelValue":r[0]||(r[0]=v=>i.value=v),rules:[u],label:"Company Name",placeholder:"Enter company name"},null,8,["modelValue","rules"])]),_:1}),e(g,{cols:"12"},{default:a(()=>[e(_,{type:"submit",class:"me-4"},{default:a(()=>[h("Submit")]),_:1}),e(_,{variant:"tonal",color:"error",onClick:c},{default:a(()=>[h("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])}}}),pe=T({__name:"EditCompanyDrawer",props:{isDrawerOpen:{type:Boolean},companyId:{}},emits:["update:isDrawerOpen","companyUpdated"],setup(D,{emit:y}){const p=D,d=y,i=s(""),m=s(null),u=async()=>{if(p.companyId)try{const n=await fetch(`/api/companies/${p.companyId}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(!n.ok)throw new Error("Failed to fetch company details.");const r=await n.json();i.value=r.companyName||""}catch(n){console.error("Error fetching company details:",n)}},c=()=>{d("update:isDrawerOpen",!1),X(()=>{var n;return(n=m.value)==null?void 0:n.resetValidation()})},V=async()=>{if(p.companyId)try{const n=await fetch(`/api/companies/${p.companyId}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:JSON.stringify({company_name:i.value})});if(!n.ok)throw new Error("Failed to update company.");const r=await n.json();d("companyUpdated",{success:"Company updated successfully!",company:r}),c()}catch(n){console.error("Error updating company:",n),d("companyUpdated",{error:"Failed to update company. Please try again."})}};return z(()=>p.companyId,u),q(u),(n,r)=>{const C=P;return U(),F(G,{temporary:"",width:400,location:"end",border:"none",class:"scrollable-content","model-value":p.isDrawerOpen,"onUpdate:modelValue":c},{default:a(()=>[e(C,{title:"Edit Company",onCancel:c}),e(E),e(x,null,{default:a(()=>[e(R,{ref_key:"refForm",ref:m,onSubmit:j(V,["prevent"])},{default:a(()=>[e(oe,{modelValue:i.value,"onUpdate:modelValue":r[0]||(r[0]=f=>i.value=f),label:"Company Name",rules:"[v => !!v || 'This field is required.']"},null,8,["modelValue"]),e(B,null,{default:a(()=>[e(g,null,{default:a(()=>[e(_,{type:"submit"},{default:a(()=>[h("Save")]),_:1}),e(_,{type:"reset",variant:"tonal",color:"error",onClick:c},{default:a(()=>[h("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["model-value"])}}}),me={class:"me-3 d-flex gap-3"},de={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},ce={style:{"inline-size":"15.625rem"}},ue={class:"text-base"},aa=T({__name:"index",setup(D){const y=s(""),p=s(),d=s(),i=s(),m=s(10),u=s(1),c=s(),V=s(),n=s([]),r=s(!1),C=s(null),f=s(!1),v=[{title:"Company Name",key:"companyName"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1,align:"end"}],H=t=>{C.value=t,r.value=!0},{data:N,execute:b}=te(()=>{const t=new URLSearchParams({page:String(u.value),itemsPerPage:String(m.value)}).toString();return localStorage.getItem("accessToken"),`/paginatedCompanies?${t}`},{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},credentials:"include"}),J=O(()=>{var t;return((t=N.value)==null?void 0:t.data)||[]}),L=O(()=>{var t;return((t=N.value)==null?void 0:t.total)||0});q(async()=>{try{await b()}catch(t){console.error("Error fetching companies:",t)}}),z([y,p,d,i,m,u,c,V],()=>{b()});const M=async t=>{try{if(!(await fetch(`/api/companies/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})).ok)throw new Error("Failed to delete company.");console.log(`Company ${t} deleted successfully.`),b()}catch(o){console.error("Error deleting company:",o)}},Q=t=>{var o,w,S;(o=t.sortBy)!=null&&o.length&&(c.value=(w=t.sortBy[0])==null?void 0:w.key,V.value=(S=t.sortBy[0])==null?void 0:S.order),u.value=t.page||1,m.value=t.itemsPerPage||10,b()};return(t,o)=>{const w=W,S=A,Z=ae("IconBtn");return U(),Y("section",null,[e($,{class:"mb-6"},{default:a(()=>[e(le,{class:"pb-4"},{default:a(()=>[e(ne,null,{default:a(()=>[h("Filters")]),_:1})]),_:1}),e(x,null,{default:a(()=>[e(B,null,{default:a(()=>[e(g,{cols:"12",sm:"4"},{default:a(()=>[e(w,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=l=>p.value=l),placeholder:"Select Role",items:t.roles,clearable:"","clear-icon":"bx-x"},null,8,["modelValue","items"])]),_:1}),e(g,{cols:"12",sm:"4"},{default:a(()=>[e(w,{modelValue:d.value,"onUpdate:modelValue":o[1]||(o[1]=l=>d.value=l),placeholder:"Select Plan",items:t.plans,clearable:"","clear-icon":"bx-x"},null,8,["modelValue","items"])]),_:1}),e(g,{cols:"12",sm:"4"},{default:a(()=>[e(w,{modelValue:i.value,"onUpdate:modelValue":o[2]||(o[2]=l=>i.value=l),placeholder:"Select Status",items:t.status,clearable:"","clear-icon":"bx-x"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),e(E),e(x,{class:"d-flex flex-wrap gap-4"},{default:a(()=>[k("div",me,[e(w,{"model-value":m.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":o[3]||(o[3]=l=>m.value=parseInt(l,10))},null,8,["model-value"])]),e(re),k("div",de,[k("div",ce,[e(S,{modelValue:y.value,"onUpdate:modelValue":o[4]||(o[4]=l=>y.value=l),placeholder:"Search Company"},null,8,["modelValue"])]),e(_,{"prepend-icon":"bx-plus",onClick:o[5]||(o[5]=l=>f.value=!0)},{default:a(()=>[h(" Add New Company ")]),_:1})])]),_:1})]),_:1}),e(ie,{isDrawerOpen:f.value,"onUpdate:isDrawerOpen":o[6]||(o[6]=l=>f.value=l)},null,8,["isDrawerOpen"]),e(pe,{isDrawerOpen:r.value,"onUpdate:isDrawerOpen":o[7]||(o[7]=l=>r.value=l),"company-id":C.value,onCompanyUpdated:t.handleCompanyUpdated},null,8,["isDrawerOpen","company-id","onCompanyUpdated"]),e($,{class:"mb-6"},{default:a(()=>[e(se,{"items-per-page":m.value,"onUpdate:itemsPerPage":o[8]||(o[8]=l=>m.value=l),"model-value":n.value,"onUpdate:modelValue":o[9]||(o[9]=l=>n.value=l),page:u.value,"onUpdate:page":o[10]||(o[10]=l=>u.value=l),items:J.value,"item-value":"id","items-length":L.value,headers:v,class:"text-no-wrap","show-select":"","onUpdate:options":Q},{"item.companyName":a(({item:l})=>[k("h6",ue,ee(l.companyName),1)]),"item.actions":a(({item:l})=>[e(_,{icon:"",variant:"text",color:"medium-emphasis",onClick:K=>H(l.id)},{default:a(()=>[e(I,{icon:"bx-pencil"})]),_:2},1032,["onClick"]),e(Z,{onClick:K=>M(l.id)},{default:a(()=>[e(I,{icon:"bx-trash"})]),_:2},1032,["onClick"])]),_:1},8,["items-per-page","model-value","page","items","items-length"])]),_:1})])}}});export{aa as default};
